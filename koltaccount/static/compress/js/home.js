$(function(){let a="",t=0,e=!0,o=!1;preload_show(),$.ajax({url:"get_master_password/",type:"GET",success:function(t){"doesnotexist"!=(a=t.result)?$("#EnterKeyModal").modal("show"):($("#in-old_password").attr("disabled","disabled").css("display","none"),$('label[for="in-old_password"]').css("display","none"),$(".modal-body-master-password").css("height","175px"),$("#btn-send_master_password").text("Создать"),$("#MasterPasswordModal").modal("show")),preload_hide()},error:function(a,t,e){"Forbidden"==e&&(swal("Ошибка 403","Этот сайт требует наличия файла cookie CSRF при отправке форм. Если вы настроили свой браузер так, чтобы он не сохранял файлы cookie, включите их снова, по крайней мере, для этого сайта."),preload_hide())}});const s="login";function n(a){for(var t=(new Date).getTime();t+a>=(new Date).getTime(););}function d(t,e,o,s){preload_show(),$.ajax({url:"create_account/",type:"POST",data:{site:encrypt(t,a),description:encrypt(e,a),login:encrypt(o,a),password:encrypt(s,a)},success:function(a){"success"==a.status?console.log(a.account_id):"error"==a.status?"accountlimitreached"==a.message?swal("Ошибка","Достигнут лимит в 200 аккаунтов"):swal("Ошибка",a.message):swal("Ошибка",a.result),preload_hide()},error:function(a,t,e){"Forbidden"==e&&(swal("Ошибка 403","Этот сайт требует наличия файла cookie CSRF при отправке форм. Если вы настроили свой браузер так, чтобы он не сохранял файлы cookie, включите их снова, по крайней мере, для этого сайта."),preload_hide())}})}function i(t){preload_show(),setTimeout(function(){const e=enMP(t),o=e.key,s=e.result;let n={},d={},i={},l={},r=$("td");r.length>0&&r.each(function(t,e){let s=e.getAttribute("data-id");"td-site"==e.className?n[s]=encrypt(e.innerHTML,o):"td-description"==e.className?d[s]=encrypt(e.innerHTML,o):"td-login td-hide"==e.className?i[s]=encrypt(decrypt(e.innerHTML,a),o):"td-password td-hide"==e.className&&(l[s]=encrypt(decrypt(e.innerHTML,a),o))}),$.ajax({url:"change_or_create_master_password/",type:"POST",data:{sites:JSON.stringify(n),descriptions:JSON.stringify(d),logins:JSON.stringify(i),passwords:JSON.stringify(l),new_master_password:s},success:function(a){preload_hide(),"success"==a.status?location.href=location.href:swal("Ошибка",a.result)},error:function(a,t,e){"Forbidden"==e&&(swal("Ошибка 403","Этот сайт требует наличия файла cookie CSRF при отправке форм. Если вы настроили свой браузер так, чтобы он не сохранял файлы cookie, включите их снова, по крайней мере, для этого сайта."),preload_hide())}})},600)}function l(){let t=$("#in-enter_master_password").val();""==t?($("#in-enter_master_password").focus(),$("#EnterKeyModal").modal("show")):(preload_show(),setTimeout(function(){""==(t=deMP(a,t))?($("#in-enter_master_password").val(""),$("#in-enter_master_password").focus(),$("#EnterKeyModal").modal("show")):(a=t,o=!0,$("#EnterKeyModal").modal("hide")),preload_hide()},600))}function r(t){let o="";""!=(o=t==s?decrypt($("#modal-login").val(),a):decrypt($("#modal-password").val(),a))?e?function(a){let t=$("<input>");$("#AccountModal").append(t),t.val(a).select(),document.execCommand("copy"),t.remove()}(o):(swal(o),e=!0):swal("Ошибка","Не правильный пароль")}$(".footer-urls").hide(),$("#btn_master_import").on("change",function(){var a=this.files[0],t=new FileReader;t.onloadend=function(){var a=JSON.parse(t.result);for(var e in a)console.log(a[e].site),d(a[e].site,a[e].description,a[e].login,a[e].password),n(2e3)},t.readAsText(a)}),$("#btn-enter_master_password").on("click",function(){l()}),$("#btn-send_account").on("click",function(){""==$("#in-site").val()?swal('Заполните поле "Сайт"'):""==$("#in-description").val()?swal('Заполните поле "Описание"'):""==$("#in-login").val()?swal('Заполните поле "Логин"'):""==$("#in-password").val()?swal('Заполните поле "Пароль"'):function(){preload_show();let t=$("#in-site").val(),e=$("#in-description").val(),o=encrypt($("#in-login").val(),a),s=encrypt($("#in-password").val(),a);$.ajax({url:"create_account/",type:"POST",data:{site:encrypt(t,a),description:encrypt(e,a),login:o,password:s},success:function(a){let n=a.account_id;if("success"==a.status){let a='<tr data-toggle="modal" data-target="#AccountModal" data-id="'+n+'"><td class="td-favicon"><img data-id="'+n+'" class="favicon-sites" height="16" width="16" alt="icon" src="https://favicon.yandex.net/favicon/'+t+'"></td><td class="td-site" data-id="'+n+'">'+t+'</td><td class="td-description" data-id="'+n+'">'+e+'</td><td class="td-login td-hide" data-id="'+n+'">'+o+'</td><td class="td-password td-hide" data-id="'+n+'">'+s+"</td></tr>";$("tbody").append(a),$("table").trigger("sorton",[[[1,0]]]),$("#CreateAccountModal").modal("hide"),$("#in-site").val(""),$("#in-description").val("")}else"error"==a.status?"accountlimitreached"==a.message?swal("Ошибка","Достигнут лимит в 200 аккаунтов"):swal("Ошибка",a.message):swal("Ошибка",a.result);preload_hide()},error:function(a,t,e){"Forbidden"==e&&(swal("Ошибка 403","Этот сайт требует наличия файла cookie CSRF при отправке форм. Если вы настроили свой браузер так, чтобы он не сохранял файлы cookie, включите их снова, по крайней мере, для этого сайта."),preload_hide())}})}()});let c=!1,u=!1;function p(){$("#in-new_password").val()==$("#in-repeat_new_password").val()?($("#in-repeat_new_password").removeClass("input-invalid"),u=!0):($("#in-repeat_new_password").addClass("input-invalid"),u=!1)}function w(){""==$("#in-old_password").val()&&!$("#in-old_password").attr("disabled")||""!=$("#in-old_password").val()&&$("#in-old_password").attr("disabled")?swal('Заполните поле "Старый пароль"'):""==$("#in-new_password").val()?swal('Заполните поле "Новый пароль"'):$("#in-old_password").val()==$("#in-new_password").val()?swal("Старый и новый пароль не могут совпадать"):""==$("#in-repeat_new_password").val()?swal('Заполните поле "Подтвердите новый пароль"'):$("#in-new_password").val()!=$("#in-repeat_new_password").val()?swal("Пароли не совпадают"):a==$("#in-old_password").val()||$("#in-old_password").attr("disabled")?c&&u&&i($("#in-repeat_new_password").val()):swal("Не правильный старый пароль")}$("#in-new_password").on("input",function(){!function(){let a=$("#in-new_password").val(),t=!1,e=!1,o=!1,s=!1;a.length<8?($("#length").removeClass("valid").addClass("invalid"),t=!1):($("#length").removeClass("invalid").addClass("valid"),t=!0);a.match(/[a-z]/)?($("#letter").removeClass("invalid").addClass("valid"),e=!0):($("#letter").removeClass("valid").addClass("invalid"),e=!1);a.match(/[A-Z]/)?($("#capital").removeClass("invalid").addClass("valid"),o=!0):($("#capital").removeClass("valid").addClass("invalid"),o=!1);a.match(/[0-9]/)?($("#number").removeClass("invalid").addClass("valid"),s=!0):($("#number").removeClass("valid").addClass("invalid"),s=!1);t&&e&&o&&s?($("#in-new_password").removeClass("input-invalid"),c=!0):($("#in-new_password").addClass("input-invalid"),c=!1);p()}()}).focus(function(){$("#password_info").show()}).blur(function(){$("#password_info").hide()}),$("#in-repeat_new_password").on("input",function(){p()}),$("#btn-send_master_password").on("click",function(){w()}),$(".modal-body-master-password input").on("keypress",function(a){13==a.keyCode&&w()}),$("#modal-btn-account_delete").on("click",function(){swal({title:"Вы уверены?",text:"Эту запись потом не восстановить!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Да, удалить это!"},function(){var a;a=$("#modal-btn-account_delete").attr("data-id"),preload_show(),$.ajax({url:"delete_account/",type:"POST",data:{account_id:a},success:function(t){"success"==t.status?($('tr[data-id="'+a+'"]').hide(),$("#AccountModal").modal("hide")):"doesnotexist"==t.result?swal("Ошибка","Аккаунт не найден"):swal("Ошибка",t.result),preload_hide()},error:function(a,t,e){"Forbidden"==e&&(swal("Ошибка 403","Этот сайт требует наличия файла cookie CSRF при отправке форм. Если вы настроили свой браузер так, чтобы он не сохранял файлы cookie, включите их снова, по крайней мере, для этого сайта."),preload_hide())}})})}),$("#modal-btn-save").on("click",function(){""==$("#modal-site").val()?swal('Заполните поле "Сайт"'):""==$("#modal-description").val()?swal('Заполните поле "Описание"'):function(){preload_show();let t=$("#modal-site").val(),e=$("#modal-description").val(),o=$("#modal-new_login").val(),s=$("#modal-new_password").val(),n=$("#modal-btn-account_delete").attr("data-id");""!=o&&(o=encrypt(o,a)),""!=s&&(s=encrypt(s,a)),$.ajax({url:"change_info_account/",type:"POST",data:{site:encrypt(t,a),description:encrypt(e,a),new_login:o,new_password:s,account_id:n},success:function(a){if("success"==a.status){let a=$('tr[data-id="'+n+'"]');a.find(".td-favicon").find("img").attr("src","https://favicon.yandex.net/favicon/"+t),a.find(".td-site").text(t),a.find(".td-description").text(e),""!=o&&(a.find(".td-login").text(o),$("#modal-new_login").val("")),""!=s&&(a.find(".td-password").text(s),$("#modal-new_password").val("")),$("table").trigger("sorton",[[[1,0]]]),$("#AccountModal").modal("hide")}else"doesnotexist"==a.result?swal("Ошибка","Аккаунт не найден"):swal("Ошибка",a.result);preload_hide()},error:function(a,t,e){"Forbidden"==e&&(swal("Ошибка 403","Этот сайт требует наличия файла cookie CSRF при отправке форм. Если вы настроили свой браузер так, чтобы он не сохранял файлы cookie, включите их снова, по крайней мере, для этого сайта."),preload_hide())}})}()}),$("#modal-btn-login").on("click",function(){r(s)}),$("#modal-btn-password").on("click",function(){r("password")}),$("#AccountModal").on("show.bs.modal",function(a){let t=$(a.relatedTarget).attr("data-id"),e=$('.td-site[data-id="'+t+'"]').text(),o=$('.td-description[data-id="'+t+'"]').text(),s=$('.td-login[data-id="'+t+'"]').text(),n=$('.td-password[data-id="'+t+'"]').text();$("#modal-site").val(e),$("#modal-description").val(o),$("#modal-login").val(s),$("#modal-password").val(n),$("#modal-new_password").val(""),$("#modal-btn-account_delete").attr("data-id",t),$("#modal-btn-account_delete").attr("data-site",e)}),$("#AccountModal").on("shown.bs.modal",function(a){account_modal_tour()}),$("#EnterKeyModal").on("shown.bs.modal",function(){$("#in-enter_master_password").focus()}),$("#MasterPasswordModal").on("hide.bs.modal",function(){"doesnotexist"==a&&$(".js-reload_master_password_modal").show()}),$("#EnterKeyModal").on("hide.bs.modal",function(){if(o){let t=$("td");t.length>0&&(t.each(function(t,e){"td-login td-hide"!=e.className&&"td-password td-hide"!=e.className&&"td-favicon"!=e.className&&(e.innerHTML=decrypt(e.innerHTML,a))}),$("tr").length>1&&$("#Accounts_table").tablesorter({sortList:[[1,0]]})),$(".favicon-sites").each(function(){$(this).attr("src","https://favicon.yandex.net/favicon/"+$('.td-site[data-id="'+$(this).attr("data-id")+'"]').text())}),$(".footer-urls").show(),$(".user-username").show(),$(".js-reload_enter_key_modal").hide(),$(".account_container").show(),account_table_tour()}else $(".js-reload_enter_key_modal").show(),$("#in-enter_master_password").val("")}),$("#CreateAccountModal").on("hidden.bs.modal",function(){$("#in-login").val(""),$("#in-password").val("")}),$("#in-search").on("keyup",function(){let a=$("tbody tr");if(""==$(this).val())a.fadeIn(100);else{let t=$(".td-site:contains("+$(this).val().toLowerCase()+")");a.fadeOut(100),t.parent().fadeIn(100)}}),$("#in-enter_master_password").on("keydown",function(a){13==a.keyCode&&l()}),$("#modal-btn-password").on("touchend mouseup",function(){clearTimeout(t)}).on("touchstart mousedown",function(){t=window.setTimeout(function(){e=!1,r("password")},500)}),$("#modal-btn-login").on("touchend mouseup",function(){clearTimeout(t)}).on("touchstart mousedown",function(){t=window.setTimeout(function(){e=!1,r(s)},500)})});